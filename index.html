<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
/>
<title>Orb V1.1b — Silent + Debug Console</title>
<style>
  :root{
    --bg:#0b0f14;
    --orb:#1e2633;
    --orb-glow:#2a3850;
    --accent:#a3ef2f;
    --text:#e8eef5;
    --muted:#9fb2c9;
    --danger:#ff4d4f;
    --ok:#2ecc71;
    --panel:#0f141b;
    --panel-2:#0d1118;
    --shadow:rgba(0,0,0,.55);
  }
  *{box-sizing:border-box}
  html,body{
    margin:0; height:100%; width:100%;
    background:radial-gradient(1200px 800px at 50% 20%, #0f141b 0%, var(--bg) 60%, #05080d 100%);
    color:var(--text);
    overscroll-behavior:none;
    touch-action:manipulation; /* keep taps crisp; allow scroll edge gestures */
    -webkit-tap-highlight-color: transparent;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  }
  .stage{
    position:fixed; inset:0;
    display:grid; place-items:center;
  }
  .orb{
    --size:min(60vmin, 520px);
    height:var(--size); width:var(--size);
    border-radius:50%;
    background:
      radial-gradient(60% 60% at 55% 35%, rgba(255,255,255,.08), transparent 60%),
      radial-gradient(50% 50% at 40% 65%, rgba(255,255,255,.04), transparent 60%),
      linear-gradient(145deg, var(--orb) 0%, #121925 100%);
    box-shadow:
      0 0 0 2px rgba(255,255,255,.04) inset,
      0 25px 60px -10px var(--shadow),
      0 0 140px 20px var(--orb-glow);
    position:relative;
    display:grid; place-items:center;
    user-select:none;
    touch-action:none; /* we’ll manage gestures */
    cursor:pointer;
  }
  .orb::after{
    content:"";
    position:absolute; inset:-3%;
    border-radius:50%;
    background: radial-gradient(60% 60% at 50% 50%, rgba(163,239,47,.08), transparent 70%);
    filter:blur(10px);
    pointer-events:none;
  }
  .pip{
    position:absolute;
    width:12%;
    aspect-ratio:1;
    border-radius:50%;
    left:50%; top:50%;
    transform:translate(-50%,-50%);
    background: radial-gradient(circle at 50% 40%, var(--accent), #6cd21b 60%, #2c6a0f 100%);
    box-shadow:
      0 4px 14px rgba(0,0,0,.45),
      0 0 28px rgba(163,239,47,.55);
    pointer-events:none;
  }
  /* Ripple feedback */
  .ripple{
    position:absolute; border-radius:999px; pointer-events:none;
    background:radial-gradient(circle, rgba(163,239,47,.35), rgba(163,239,47,0) 60%);
    transform:translate(-50%,-50%) scale(.2);
    animation:rip .6s ease-out forwards;
    will-change: transform, opacity;
  }
  @keyframes rip{
    to{ transform:translate(-50%,-50%) scale(1.4); opacity:0; }
  }

  /* Debug Console */
  .debug{
    position:fixed; left:12px; bottom:12px; width:min(92vw, 520px);
    background:
      linear-gradient(0deg, rgba(0,0,0,.35), rgba(0,0,0,.35)),
      linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
    border:1px solid rgba(255,255,255,.07);
    border-radius:16px;
    box-shadow: 0 10px 26px -8px var(--shadow), inset 0 1px 0 rgba(255,255,255,.04);
    backdrop-filter: blur(8px);
    overflow:hidden;
  }
  .debug__bar{
    display:flex; align-items:center; gap:8px;
    padding:8px 10px;
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .dot{
    height:10px; width:10px; border-radius:50%;
    background:var(--ok); box-shadow:0 0 8px var(--ok);
  }
  .dot.paused{ background:var(--danger); box-shadow:0 0 8px var(--danger); }
  .debug__title{ font-weight:600; font-size:.95rem; letter-spacing:.2px; color:#e6f3ff; }
  .spacer{ flex:1 }
  .btn{
    appearance:none; border:1px solid rgba(255,255,255,.1); color:var(--text);
    background:#0e1621; border-radius:999px; padding:6px 10px; font-size:.8rem; cursor:pointer;
  }
  .btn:active{ transform:scale(.98) }
  .row{
    display:flex; gap:10px; padding:8px 10px; flex-wrap:wrap; align-items:center;
  }
  .kv{
    display:flex; gap:6px; align-items:center; font-size:.78rem; color:var(--muted);
    background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); padding:4px 8px; border-radius:10px;
  }
  .kv strong{ color:#e8eef5; font-weight:600 }
  .log{
    max-height:28vh; overflow:auto; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-size:.82rem; line-height:1.4; padding:8px 10px 10px;
  }
  .entry{
    padding:4px 6px; border-left:3px solid transparent; margin:4px 0; border-radius:6px;
    background:rgba(255,255,255,.03);
  }
  .entry.ev{ border-color:#86e59a } /* event */
  .entry.err{ border-color:#ff8082 } /* errors */
  .entry.sys{ border-color:#86b5ff } /* system */
  .muted{ color:var(--muted) }
  .kbd{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    background:rgba(255,255,255,.07); padding:2px 6px; border-radius:6px; font-size:.78rem;
  }

  /* Small toggle to collapse console (triple-tap also toggles) */
  .collapse{
    position:absolute; right:10px; top:10px; opacity:.8;
  }
  .collapsed .log, .collapsed .row{ display:none }
</style>
</head>
<body>
  <div class="stage">
    <div id="orb" class="orb" aria-label="Interactive Orb" role="button">
      <div class="pip" aria-hidden="true"></div>
    </div>
  </div>

  <section id="debug" class="debug" aria-live="polite">
    <div class="debug__bar">
      <span id="led" class="dot" title="logging status"></span>
      <div class="debug__title">Debug Console</div>
      <div class="spacer"></div>
      <button id="btnPause" class="btn" type="button">Pause</button>
      <button id="btnClear" class="btn" type="button">Clear</button>
      <button id="btnCollapse" class="btn collapse" type="button">▾</button>
    </div>
    <div class="row" id="stats">
      <div class="kv"><strong>Down</strong><span id="cDown">0</span></div>
      <div class="kv"><strong>Up</strong><span id="cUp">0</span></div>
      <div class="kv"><strong>Click</strong><span id="cClick">0</span></div>
      <div class="kv"><strong>Taps</strong><span id="cTap">0</span></div>
      <div class="kv"><strong>Double</strong><span id="cDbl">0</span></div>
      <div class="kv"><strong>Triple</strong><span id="cTri">0</span></div>
      <div class="kv"><strong>Pointer</strong><span id="cPtr">0</span></div>
      <div class="kv"><strong>Move</strong><span id="cMove">0</span></div>
    </div>
    <div id="log" class="log" role="log" aria-label="Event log"></div>
  </section>

<script>
(function(){
  "use strict";

  // ======= Config =======
  const TAP_MAX_DELAY_MS = 300;      // time between taps to be considered multi-tap
  const TAP_MAX_MOVE_PX  = 18;       // movement tolerance to remain a tap
  const TRIPLE_TAP_TOGGLES_CONSOLE = true;

  // ======= Elements =======
  const orb = document.getElementById('orb');
  const logEl = document.getElementById('log');
  const led = document.getElementById('led');
  const btnPause = document.getElementById('btnPause');
  const btnClear = document.getElementById('btnClear');
  const btnCollapse = document.getElementById('btnCollapse');
  const debug = document.getElementById('debug');

  const counters = {
    down:document.getElementById('cDown'),
    up:document.getElementById('cUp'),
    click:document.getElementById('cClick'),
    tap:document.getElementById('cTap'),
    dbl:document.getElementById('cDbl'),
    tri:document.getElementById('cTri'),
    ptr:document.getElementById('cPtr'),
    move:document.getElementById('cMove'),
  };

  // ======= State =======
  let logging = true;
  let collapsed = false;

  let pointerActive = false;
  let activePointerId = null;
  let startX = 0, startY = 0;
  let maxTravel = 0;

  let tapCount = 0;
  let lastTapTime = 0;
  let lastTapX = 0, lastTapY = 0;
  let tapTimer = null;

  // ======= Utils =======
  const fmt = (n)=> new Date(n).toLocaleTimeString([], {hour12:false});
  function addLog(type, msg){
    if(!logging && type!=='sys') return;
    const row = document.createElement('div');
    row.className = `entry ${type}`;
    row.innerHTML = `<span class="muted">[${fmt(Date.now())}]</span> ${msg}`;
    logEl.appendChild(row);
    logEl.scrollTop = logEl.scrollHeight;
  }
  function inc(el){
    el.textContent = String( (parseInt(el.textContent, 10) || 0) + 1 );
  }
  function rippleAt(x, y, parent){
    const r = document.createElement('div');
    r.className = 'ripple';
    r.style.left = x + 'px';
    r.style.top  = y + 'px';
    r.style.width = r.style.height = Math.max(parent.clientWidth, parent.clientHeight) * .6 + 'px';
    parent.appendChild(r);
    r.addEventListener('animationend', ()=> r.remove(), {once:true});
  }
  function within(a, b, tol){ return Math.abs(a-b) <= tol; }

  // ======= Core Tap Detector =======
  function handleTap(x, y){
    const now = Date.now();
    const withinTime = (now - lastTapTime) <= TAP_MAX_DELAY_MS;
    const withinDist = within(x, lastTapX, TAP_MAX_MOVE_PX) && within(y, lastTapY, TAP_MAX_MOVE_PX);

    if(withinTime && withinDist){
      tapCount += 1;
    }else{
      tapCount = 1;
    }

    lastTapTime = now;
    lastTapX = x; lastTapY = y;

    clearTimeout(tapTimer);
    tapTimer = setTimeout(() => {
      // Resolve tap sequence
      if(tapCount === 1){
        inc(counters.tap);
        addLog('ev', `<strong>Tap</strong> at (${Math.round(x)}, ${Math.round(y)})`);
      }else if(tapCount === 2){
        inc(counters.dbl);
        addLog('ev', `<strong>Double-tap</strong> at (${Math.round(x)}, ${Math.round(y)})`);
      }else{
        inc(counters.tri);
        addLog('ev', `<strong>${tapCount}-tap</strong> at (${Math.round(x)}, ${Math.round(y)})`);
        if(TRIPLE_TAP_TOGGLES_CONSOLE && tapCount >= 3){
          toggleCollapse();
        }
      }
      tapCount = 0;
    }, TAP_MAX_DELAY_MS + 20);
  }

  // ======= Pointer Handlers (canonical) =======
  function onPointerDown(e){
    // Only primary interactions (avoid secondary mouse buttons)
    if(e.isPrimary === false) return;

    pointerActive = true;
    activePointerId = e.pointerId;
    startX = e.clientX; startY = e.clientY; maxTravel = 0;

    // Capture pointer to the orb to keep receiving events even if finger leaves
    if(orb.setPointerCapture){
      try{ orb.setPointerCapture(activePointerId); }catch(_){}
    }

    inc(counters.down);
    inc(counters.ptr);

    addLog('ev', `<strong>pointerdown</strong> id=${e.pointerId} type=${e.pointerType} @ (${Math.round(e.clientX)}, ${Math.round(e.clientY)})`);
    rippleAt(e.offsetX ?? (e.clientX - orb.getBoundingClientRect().left),
             e.offsetY ?? (e.clientY - orb.getBoundingClientRect().top),
             orb);
  }

  function onPointerMove(e){
    if(!pointerActive || e.pointerId !== activePointerId) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;
    const dist = Math.hypot(dx, dy);
    if(dist > maxTravel) maxTravel = dist;
    inc(counters.move);
  }

  function onPointerUp(e){
    if(e.pointerId !== activePointerId) return;

    pointerActive = false;
    activePointerId = null;

    inc(counters.up);
    addLog('ev', `<strong>pointerup</strong> type=${e.pointerType} travel=${Math.round(maxTravel)}px`);

    // Tap classification
    const rect = orb.getBoundingClientRect();
    const x = e.clientX, y = e.clientY;
    if(maxTravel <= TAP_MAX_MOVE_PX){
      handleTap(x, y);
    }
  }

  function onPointerCancel(e){
    if(e.pointerId !== activePointerId) return;
    pointerActive = false;
    activePointerId = null;
    addLog('err', `<strong>pointercancel</strong>`);
  }

  // ======= Click (mouse synthesis) =======
  function onClick(e){
    inc(counters.click);
    addLog('ev', `<strong>click</strong> button=${e.button} @ (${Math.round(e.clientX)}, ${Math.round(e.clientY)})`);
  }

  // ======= Touch fallbacks (just in case) =======
  // Prevent passive scrolling on direct orb touches while preserving page scroll elsewhere.
  function onTouchStart(e){
    if(e.target === orb){ e.preventDefault(); } // keep tap tight
  }
  function onTouchEnd(e){
    // No-op; pointer events already handled. Kept for completeness.
  }

  // ======= Keyboard (debug only) =======
  document.addEventListener('keydown', (e)=>{
    if(e.key.toLowerCase() === 'd'){
      togglePause();
    } else if(e.key.toLowerCase() === 'c'){
      clearLog();
    } else if(e.key === 'ArrowDown'){
      toggleCollapse();
    }
  });

  // ======= Debug Console Controls =======
  function togglePause(){
    logging = !logging;
    btnPause.textContent = logging ? 'Pause' : 'Resume';
    led.classList.toggle('paused', !logging);
    addLog('sys', `<span class="kbd">logging</span> ${logging ? 'enabled' : 'paused'}`);
  }
  function clearLog(){
    logEl.innerHTML = '';
    addLog('sys', '<span class="kbd">log</span> cleared');
  }
  function toggleCollapse(){
    collapsed = !collapsed;
    debug.classList.toggle('collapsed', collapsed);
    btnCollapse.textContent = collapsed ? '▴' : '▾';
  }

  btnPause.addEventListener('click', togglePause, {passive:true});
  btnClear.addEventListener('click', clearLog, {passive:true});
  btnCollapse.addEventListener('click', toggleCollapse, {passive:true});

  // ======= Bind Events =======
  // Pointer events cover mouse, pen, and touch on modern Chrome (Android included).
  orb.addEventListener('pointerdown', onPointerDown);
  orb.addEventListener('pointermove', onPointerMove);
  orb.addEventListener('pointerup', onPointerUp);
  orb.addEventListener('pointercancel', onPointerCancel);

  // Click for mouse users (some browsers still synthesize distinct click)
  orb.addEventListener('click', onClick);

  // Touch fallbacks to keep scroll/tap behavior tidy
  orb.addEventListener('touchstart', onTouchStart, {passive:false});
  orb.addEventListener('touchend', onTouchEnd, {passive:true});

  // ======= Startup =======
  addLog('sys', 'Orb V1.1b ready. <span class="kbd">D</span>=pause, <span class="kbd">C</span>=clear, <span class="kbd">▼</span>=collapse, triple-tap toggles console.');
})();
</script>
</body>
</html>


